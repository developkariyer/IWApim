<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTable Example</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css" rel="stylesheet">
	<link href="https://cdn.datatables.net/buttons/2.3.7/css/buttons.dataTables.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css">

    <!-- jQuery (Make sure this is loaded first) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.3.7/js/dataTables.buttons.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.3.7/js/buttons.colVis.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/js/bootstrap-select.min.js"></script>
</head>
<body>

<table id="example" class="display table table-striped table-bordered" style="width:100%">
    <thead>
        <tr>
            <th>IWASKU</th>
            <th>
                <select id="productCategoryFilter" class="selectpicker form-select-sm" multiple data-selected-text-format="count > 3" title="Kategori"></select>
            </th>
            <th>
                <select id="productIdentifierFilter" class="selectpicker form-select-sm" multiple data-selected-text-format="count > 3" title="Kod"></select>
            </th>
            <th>Ürün Adı</th>
            <th>
                <select id="variationSizeFilter" class="selectpicker form-select-sm" multiple data-selected-text-format="count > 3" title="Ebat"></select>
            </th>
            <th>
                <select id="variationColorFilter" class="selectpicker form-select-sm" multiple data-selected-text-format="count > 3" title="Renk"></select>
            </th>
            <th>Ebatlar</select>
            </th>
            <th>Örnek Resim</th>
            <th>Ürün Maliyeti</th>
            <th>Dağıtım Modeli 1</th>
            <th>Dağıtım Modeli 2</th>
            <th>Dağıtım Modeli 3</th>
        </tr>
    </thead>
    <tbody>
        {% for product in products %}
            <tr>
                <td>{{ product.iwasku }}</td>
                <td>{{ product.productCategory }}</td>
                <td>{{ product.productIdentifier }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.variationSize }}</td>
                <td>{{ product.variationColor }}</td>
                <td>{{ product.packageDimension1 }}x{{ product.packageDimension2 }}x{{ product.packageDimension3 }}cm {{ product.packageWeight }}gr</td>
                <td><img src="{{ product.imageUrl }}" alt="Product Image" style="max-width: 100px;"></td>
                <td>{{ product.productCost }}</td>
                <td>{{ product.productDimension1 }}</td>
                <td>{{ product.productDimension2 }}</td>
                <td>{{ product.productDimension3 }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    $(document).ready(function() {
        var table = $('#example').DataTable({
            dom: 'Bfrtip',  // Add Buttons to DOM
            buttons: [
                'colvis'  // Column Visibility Button
            ]
        });
        console.log(table.buttons()); // Check if buttons are being initialized
    
        // Define columns and IDs as key-value pairs
        var columns = {
            1: 'productCategory', 
            2: 'productIdentifier', 
            4: 'variationSize', 
            5: 'variationColor', 
        };
    
        // Populate the selectpicker dropdowns for each column
        {% for columnIndex, columnId in {
            1: 'productCategory', 
            2: 'productIdentifier', 
            4: 'variationSize', 
            5: 'variationColor', 
        } %}
            table.column({{ columnIndex }}).data().unique().sort().each(function(d, j) {
                $('#{{ columnId }}Filter').append('<option value="' + d + '">' + d + '</option>');
            });
        {% endfor %}
    
        // Refresh selectpicker after appending options
        $('.selectpicker').selectpicker('refresh');
    
        // Handle filtering for all select elements
        {% for columnIndex, columnId in {
            1: 'productCategory', 
            2: 'productIdentifier', 
            4: 'variationSize', 
            5: 'variationColor', 
        } %}
            $('#{{ columnId }}Filter').on('change', function() {
                var selectedValues = $(this).val();
                var searchTerm = selectedValues ? selectedValues.join('|') : '';
                table.column({{ columnIndex }}).search(searchTerm, true, false).draw();
            });
        {% endfor %}
    });
</script>
    


</body>
</html>